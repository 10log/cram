{"version":3,"file":"RayTracerTab-CRlEb3T6.mjs","sources":["../src/components/parameter-config/RayTracerTab.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport RayTracer from \"../../compute/raytracer\";\r\nimport PropertyRowFolder from \"./property-row/PropertyRowFolder\";\r\nimport PropertyRow from \"./property-row/PropertyRow\";\r\nimport PropertyRowLabel from \"./property-row/PropertyRowLabel\";\r\nimport PropertyRowButton from \"./property-row/PropertyRowButton\";\r\nimport { PropertyRowSelect } from \"./property-row/PropertyRowSelect\";\r\nimport { createPropertyInputs, useSolverProperty, PropertyButton } from \"./SolverComponents\";\r\nimport useToggle from \"../hooks/use-toggle\";\r\nimport { renderer } from \"../../render/renderer\";\r\nimport SourceReceiverMatrix from \"./SourceReceiverMatrix\";\r\nimport { emit } from \"../../messenger\";\r\n\r\n\r\nconst { PropertyTextInput, PropertyNumberInput, PropertyCheckboxInput } = createPropertyInputs<RayTracer>(\r\n  \"RAYTRACER_SET_PROPERTY\"\r\n);\r\n\r\n\r\nconst Parameters = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  return (\r\n    <PropertyRowFolder label=\"Parameters\" open={open} onOpenClose={toggle}>\r\n      <PropertyNumberInput uuid={uuid} label=\"Rate (ms)\" property=\"updateInterval\" tooltip=\"Sets the callback rate\" />\r\n      <PropertyNumberInput\r\n        uuid={uuid}\r\n        label=\"Order\"\r\n        property=\"reflectionOrder\"\r\n        tooltip=\"Sets the maximum reflection order\"\r\n      />\r\n      <PropertyNumberInput\r\n        uuid={uuid}\r\n        label=\"Passes\"\r\n        property=\"passes\"\r\n        tooltip=\"Number of rays shot on each callback\"\r\n      />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst SourceReceiverPairs = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  const [ignoreReceivers] = useSolverProperty<RayTracer, \"runningWithoutReceivers\">(\r\n    uuid,\r\n    \"runningWithoutReceivers\",\r\n    \"RAYTRACER_SET_PROPERTY\"\r\n  );\r\n\r\n  return (\r\n    <PropertyRowFolder label=\"Source / Receiver Pairs\" open={open} onOpenClose={toggle}>\r\n      <PropertyCheckboxInput\r\n        uuid={uuid}\r\n        label=\"Ignore Receivers\"\r\n        property=\"runningWithoutReceivers\"\r\n        tooltip=\"Ignores receiver intersections (visualization only)\"\r\n      />\r\n      <SourceReceiverMatrix uuid={uuid} disabled={ignoreReceivers} />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst StyleProperties = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  return (\r\n    <PropertyRowFolder label=\"Style Properties\" open={open} onOpenClose={toggle}>\r\n      <PropertyNumberInput\r\n        uuid={uuid}\r\n        label=\"Point Size\"\r\n        property=\"pointSize\"\r\n        tooltip=\"Sets the size of each interection point\"\r\n      />\r\n      <PropertyCheckboxInput\r\n        uuid={uuid}\r\n        label=\"Rays Visible\"\r\n        property=\"raysVisible\"\r\n        tooltip=\"Toggles the visibility of the rays\"\r\n      />\r\n      <PropertyCheckboxInput\r\n        uuid={uuid}\r\n        label=\"Points Visible\"\r\n        property=\"pointsVisible\"\r\n        tooltip=\"Toggles the visibility of the intersection points\"\r\n      />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\nconst SolverControls = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  return (\r\n    <PropertyRowFolder label=\"Solver Controls\" open={open} onOpenClose={toggle}>\r\n      <PropertyCheckboxInput uuid={uuid} label=\"Running\" property=\"isRunning\" tooltip=\"Starts/stops the raytracer\" />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst Hybrid = ({ uuid }: { uuid: string}) => {\r\n  const [open, toggle] = useToggle(true);\r\n  return (\r\n    <PropertyRowFolder label=\"Hybrid Method\" open={open} onOpenClose={toggle}> \r\n      <PropertyCheckboxInput uuid={uuid} label=\"Use Hybrid Method\" property=\"hybrid\" tooltip=\"Enables Hybrid Calculation\" />\r\n      <PropertyTextInput uuid={uuid} label=\"Transition Order\" property=\"transitionOrder\" tooltip=\"Delination between image source and raytracer\" />\r\n    </PropertyRowFolder>\r\n  )\r\n}\r\n\r\nconst Output = ({uuid}: {uuid: string}) => {\r\n  const [open, toggle] = useToggle(true);\r\n  const [impulseResponsePlaying] = useSolverProperty<RayTracer, \"impulseResponsePlaying\">(uuid, \"impulseResponsePlaying\", \"RAYTRACER_SET_PROPERTY\");\r\n  return (\r\n    <PropertyRowFolder label=\"Impulse Response\" open={open} onOpenClose={toggle}>\r\n      <PropertyButton event=\"RAYTRACER_PLAY_IR\" args={uuid} label=\"Play\" tooltip=\"Plays the calculated impulse response\" disabled={impulseResponsePlaying} />\r\n      <PropertyButton event=\"RAYTRACER_DOWNLOAD_IR\" args={uuid} label=\"Download\" tooltip=\"Downloads the calculated broadband impulse response\" />\r\n      <PropertyButton event=\"RAYTRACER_DOWNLOAD_IR_OCTAVE\" args={uuid} label=\"Download by Octave\" tooltip=\"Downloads the impulse response in each octave\" />\r\n    </PropertyRowFolder>\r\n  );\r\n}\r\n\r\nconst AmbisonicOutput = ({uuid}: {uuid: string}) => {\r\n  const [open, toggle] = useToggle(false);\r\n  const [order, setOrder] = useState(\"1\");\r\n  const [validRayCount] = useSolverProperty<RayTracer, \"validRayCount\">(uuid, \"validRayCount\", \"RAYTRACER_SET_PROPERTY\");\r\n  const disabled = !validRayCount || validRayCount === 0;\r\n\r\n  const handleDownload = () => {\r\n    emit(\"RAYTRACER_DOWNLOAD_AMBISONIC_IR\", { uuid, order: parseInt(order) });\r\n  };\r\n\r\n  return (\r\n    <PropertyRowFolder label=\"Ambisonic Output\" open={open} onOpenClose={toggle}>\r\n      <PropertyRow>\r\n        <PropertyRowLabel label=\"Order\" hasToolTip tooltip=\"Ambisonic order (1=FOA 4ch, 2=HOA 9ch, 3=HOA 16ch)\" />\r\n        <PropertyRowSelect\r\n          value={order}\r\n          onChange={({ value }) => setOrder(value)}\r\n          options={[\r\n            { value: \"1\", label: \"1st Order (4 ch)\" },\r\n            { value: \"2\", label: \"2nd Order (9 ch)\" },\r\n            { value: \"3\", label: \"3rd Order (16 ch)\" }\r\n          ]}\r\n        />\r\n      </PropertyRow>\r\n      <PropertyRow>\r\n        <PropertyRowLabel label=\"\" hasToolTip tooltip=\"Downloads ambisonic impulse response (ACN/N3D format)\" />\r\n        <PropertyRowButton onClick={handleDownload} label=\"Download\" disabled={disabled} />\r\n      </PropertyRow>\r\n    </PropertyRowFolder>\r\n  );\r\n}\r\n\r\nexport const RayTracerTab = ({ uuid }: { uuid: string }) => {\r\n  useEffect(() => {\r\n    const cells = renderer.overlays.global.cells;\r\n    const key = uuid + \"-valid-ray-count\";\r\n    if(cells.has(key)) cells.get(key)!.show();\r\n    return () => {\r\n      if (cells.has(key)) cells.get(key)!.hide();\r\n    };\r\n  }, [uuid]);\r\n  return (\r\n    <div>\r\n      <Parameters uuid={uuid} />\r\n      <SourceReceiverPairs uuid={uuid} />\r\n      <StyleProperties uuid={uuid} />\r\n      <SolverControls uuid={uuid} />\r\n      <Hybrid uuid={uuid} />\r\n      <Output uuid={uuid} />\r\n      <AmbisonicOutput uuid={uuid} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RayTracerTab;\r\n"],"names":["PropertyTextInput","PropertyNumberInput","PropertyCheckboxInput","createPropertyInputs","Parameters","uuid","open","toggle","useToggle","PropertyRowFolder","jsx","SourceReceiverPairs","ignoreReceivers","useSolverProperty","SourceReceiverMatrix","StyleProperties","SolverControls","Hybrid","Output","impulseResponsePlaying","PropertyButton","AmbisonicOutput","order","setOrder","useState","validRayCount","jsxs","PropertyRow","PropertyRowLabel","PropertyRowSelect","value","PropertyRowButton","emit","RayTracerTab","useEffect","cells","renderer","key"],"mappings":"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"}