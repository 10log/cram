{"version":3,"file":"BeamTraceTab-DGaL-VQh.mjs","sources":["../src/components/parameter-config/BeamTraceTab.tsx"],"sourcesContent":["import React, { useEffect, useReducer, useState } from \"react\";\r\nimport { BeamTraceSolver } from \"../../compute/beam-trace\";\r\nimport { emit, on } from \"../../messenger\";\r\nimport { useSolver } from \"../../store\";\r\nimport useToggle from \"../hooks/use-toggle\";\r\nimport { createPropertyInputs, PropertyButton, useSolverProperty } from \"./SolverComponents\";\r\nimport PropertyRowFolder from \"./property-row/PropertyRowFolder\";\r\nimport SourceReceiverMatrix from \"./SourceReceiverMatrix\";\r\nimport PropertyRow from \"./property-row/PropertyRow\";\r\nimport PropertyRowLabel from \"./property-row/PropertyRowLabel\";\r\nimport PropertyRowButton from \"./property-row/PropertyRowButton\";\r\nimport { PropertyRowSelect } from \"./property-row/PropertyRowSelect\";\r\nimport PropertyRowCheckbox from \"./property-row/PropertyRowCheckbox\";\r\n\r\n// PropertyButton is still used for ImpulseResponse section\r\nvoid PropertyButton;\r\n\r\nexport interface BeamTraceTabProps {\r\n  uuid: string;\r\n}\r\n\r\nconst { PropertyNumberInput } = createPropertyInputs<BeamTraceSolver>(\r\n  \"BEAMTRACE_SET_PROPERTY\"\r\n);\r\n\r\nconst visualizationModeOptions = [\r\n  { value: \"rays\", label: \"Rays Only\" },\r\n  { value: \"beams\", label: \"Beams Only\" },\r\n  { value: \"both\", label: \"Both\" }\r\n];\r\n\r\nconst SourceReceiverPairs = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  return (\r\n    <PropertyRowFolder label=\"Source / Receiver Pairs\" open={open} onOpenClose={toggle}>\r\n      <SourceReceiverMatrix uuid={uuid} eventType=\"BEAMTRACE_SET_PROPERTY\" />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst Calculation = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n\r\n  return (\r\n    <PropertyRowFolder label=\"Calculation\" open={open} onOpenClose={toggle}>\r\n      <PropertyNumberInput\r\n        uuid={uuid}\r\n        label=\"Max Reflection Order\"\r\n        property=\"maxReflectionOrderReset\"\r\n        tooltip=\"Maximum number of reflections to trace (1-6 recommended)\"\r\n      />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst Visualization = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  const [mode, setMode] = useSolverProperty<BeamTraceSolver, \"visualizationMode\">(\r\n    uuid,\r\n    \"visualizationMode\",\r\n    \"BEAMTRACE_SET_PROPERTY\"\r\n  );\r\n  const [showAllBeams, setShowAllBeams] = useSolverProperty<BeamTraceSolver, \"showAllBeams\">(\r\n    uuid,\r\n    \"showAllBeams\",\r\n    \"BEAMTRACE_SET_PROPERTY\"\r\n  );\r\n\r\n  const showBeamsOptions = mode === \"beams\" || mode === \"both\";\r\n\r\n  return (\r\n    <PropertyRowFolder label=\"Visualization\" open={open} onOpenClose={toggle}>\r\n      <PropertyRow>\r\n        <PropertyRowLabel label=\"Display Mode\" hasToolTip tooltip=\"Toggle between ray paths, beam cones, or both\" />\r\n        <PropertyRowSelect\r\n          value={mode || \"rays\"}\r\n          onChange={setMode}\r\n          options={visualizationModeOptions}\r\n        />\r\n      </PropertyRow>\r\n      {showBeamsOptions && (\r\n        <PropertyRow>\r\n          <PropertyRowLabel label=\"Show All Beams\" hasToolTip tooltip=\"Show all virtual sources, including invalid/orphaned ones\" />\r\n          <PropertyRowCheckbox\r\n            value={showAllBeams || false}\r\n            onChange={({ value }) => setShowAllBeams(value)}\r\n          />\r\n        </PropertyRow>\r\n      )}\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst BufferUsageBar = ({ percent, overflow }: { percent: number; overflow: boolean }) => {\r\n  const color = overflow ? \"#ff4444\" : percent > 80 ? \"#ffaa00\" : \"#44aa44\";\r\n  return (\r\n    <div style={{\r\n      width: \"60px\",\r\n      height: \"8px\",\r\n      background: \"#333\",\r\n      borderRadius: \"4px\",\r\n      overflow: \"hidden\",\r\n      marginRight: \"8px\"\r\n    }}>\r\n      <div style={{\r\n        width: `${Math.min(percent, 100)}%`,\r\n        height: \"100%\",\r\n        background: color,\r\n        transition: \"width 0.2s\"\r\n      }} />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Statistics = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(false);\r\n  const [, forceUpdate] = useReducer((c) => c + 1, 0) as [never, () => void];\r\n  const solver = useSolver(state => state.solvers[uuid] as BeamTraceSolver);\r\n  const numPaths = solver?.numValidPaths || 0;\r\n  const metrics = solver?.lastMetrics;\r\n  const bufferUsage = metrics?.bufferUsage;\r\n\r\n  // Force update when calculation completes to show new metrics\r\n  useEffect(() => {\r\n    const unsub1 = on(\"BEAMTRACE_CALCULATE_COMPLETE\", (id) => {\r\n      if (id === uuid) forceUpdate();\r\n    });\r\n    const unsub2 = on(\"BEAMTRACE_RESET\", (id) => {\r\n      if (id === uuid) forceUpdate();\r\n    });\r\n    return () => { unsub1(); unsub2(); };\r\n  }, [uuid]);\r\n\r\n  return (\r\n    <PropertyRowFolder label=\"Statistics\" open={open} onOpenClose={toggle}>\r\n      <PropertyRow>\r\n        <PropertyRowLabel label=\"Valid Paths\" />\r\n        <span style={{ padding: \"4px 8px\" }}>{numPaths}</span>\r\n      </PropertyRow>\r\n      {metrics && (\r\n        <>\r\n          <PropertyRow>\r\n            <PropertyRowLabel label=\"Raycasts\" />\r\n            <span style={{ padding: \"4px 8px\" }}>{metrics.raycastCount}</span>\r\n          </PropertyRow>\r\n          <PropertyRow>\r\n            <PropertyRowLabel label=\"Cache Hits\" />\r\n            <span style={{ padding: \"4px 8px\" }}>{metrics.failPlaneCacheHits}</span>\r\n          </PropertyRow>\r\n          <PropertyRow>\r\n            <PropertyRowLabel label=\"Buckets Skipped\" />\r\n            <span style={{ padding: \"4px 8px\" }}>{metrics.bucketsSkipped}</span>\r\n          </PropertyRow>\r\n        </>\r\n      )}\r\n      {bufferUsage && (\r\n        <>\r\n          <PropertyRow>\r\n            <PropertyRowLabel\r\n              label=\"Lines Buffer\"\r\n              hasToolTip\r\n              tooltip={`${bufferUsage.linesUsed.toLocaleString()} / ${bufferUsage.linesCapacity.toLocaleString()} vertices`}\r\n            />\r\n            <div style={{ display: \"flex\", alignItems: \"center\", padding: \"4px 8px\" }}>\r\n              <BufferUsageBar percent={bufferUsage.linesPercent} overflow={bufferUsage.overflowWarning} />\r\n              <span style={{ fontSize: \"11px\", color: bufferUsage.linesPercent > 80 ? \"#ffaa00\" : \"#888\" }}>\r\n                {bufferUsage.linesPercent.toFixed(1)}%\r\n              </span>\r\n            </div>\r\n          </PropertyRow>\r\n          <PropertyRow>\r\n            <PropertyRowLabel\r\n              label=\"Points Buffer\"\r\n              hasToolTip\r\n              tooltip={`${bufferUsage.pointsUsed.toLocaleString()} / ${bufferUsage.pointsCapacity.toLocaleString()} points`}\r\n            />\r\n            <div style={{ display: \"flex\", alignItems: \"center\", padding: \"4px 8px\" }}>\r\n              <BufferUsageBar percent={bufferUsage.pointsPercent} overflow={bufferUsage.overflowWarning} />\r\n              <span style={{ fontSize: \"11px\", color: bufferUsage.pointsPercent > 80 ? \"#ffaa00\" : \"#888\" }}>\r\n                {bufferUsage.pointsPercent.toFixed(1)}%\r\n              </span>\r\n            </div>\r\n          </PropertyRow>\r\n          {bufferUsage.overflowWarning && (\r\n            <PropertyRow>\r\n              <span style={{ color: \"#ff4444\", fontSize: \"11px\", padding: \"4px 8px\" }}>\r\n                ⚠️ Buffer overflow! Reduce reflection order.\r\n              </span>\r\n            </PropertyRow>\r\n          )}\r\n        </>\r\n      )}\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst ImpulseResponse = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  const solver = useSolver(state => state.solvers[uuid] as BeamTraceSolver);\r\n  const disabled = !solver || solver.numValidPaths === 0;\r\n\r\n  return (\r\n    <PropertyRowFolder label=\"Impulse Response\" open={open} onOpenClose={toggle}>\r\n      <PropertyButton\r\n        event=\"BEAMTRACE_PLAY_IR\"\r\n        args={uuid}\r\n        label=\"Play\"\r\n        tooltip=\"Play the calculated impulse response\"\r\n        disabled={disabled}\r\n      />\r\n      <PropertyButton\r\n        event=\"BEAMTRACE_DOWNLOAD_IR\"\r\n        args={uuid}\r\n        label=\"Download\"\r\n        tooltip=\"Download the impulse response as WAV\"\r\n        disabled={disabled}\r\n      />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\nconst AmbisonicOutput = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(false);\r\n  const [order, setOrder] = useState(\"1\");\r\n  const solver = useSolver(state => state.solvers[uuid] as BeamTraceSolver);\r\n  const disabled = !solver || solver.numValidPaths === 0;\r\n\r\n  const handleDownload = () => {\r\n    emit(\"BEAMTRACE_DOWNLOAD_AMBISONIC_IR\", { uuid, order: parseInt(order) });\r\n  };\r\n\r\n  return (\r\n    <PropertyRowFolder label=\"Ambisonic Output\" open={open} onOpenClose={toggle}>\r\n      <PropertyRow>\r\n        <PropertyRowLabel label=\"Order\" hasToolTip tooltip=\"Ambisonic order (1=FOA 4ch, 2=HOA 9ch, 3=HOA 16ch)\" />\r\n        <PropertyRowSelect\r\n          value={order}\r\n          onChange={({ value }) => setOrder(value)}\r\n          options={[\r\n            { value: \"1\", label: \"1st Order (4 ch)\" },\r\n            { value: \"2\", label: \"2nd Order (9 ch)\" },\r\n            { value: \"3\", label: \"3rd Order (16 ch)\" }\r\n          ]}\r\n        />\r\n      </PropertyRow>\r\n      <PropertyRow>\r\n        <PropertyRowLabel label=\"\" hasToolTip tooltip=\"Downloads ambisonic impulse response (ACN/N3D format)\" />\r\n        <PropertyRowButton onClick={handleDownload} label=\"Download\" disabled={disabled} />\r\n      </PropertyRow>\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\n// Keyboard shortcuts component for reflection order control\r\nconst KeyboardShortcuts = ({ uuid }: { uuid: string }) => {\r\n  const solver = useSolver(state => state.solvers[uuid] as BeamTraceSolver | undefined);\r\n  const [mode] = useSolverProperty<BeamTraceSolver, \"visualizationMode\">(\r\n    uuid,\r\n    \"visualizationMode\",\r\n    \"BEAMTRACE_SET_PROPERTY\"\r\n  );\r\n\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      // Don't handle if typing in an input\r\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\r\n        return;\r\n      }\r\n\r\n      const currentOrder = solver?.maxReflectionOrder ?? 3;\r\n\r\n      switch (e.key) {\r\n        case \"+\":\r\n        case \"=\":\r\n        case \"ArrowUp\":\r\n          // Increase reflection order (max 6)\r\n          if (currentOrder < 6) {\r\n            emit(\"BEAMTRACE_SET_PROPERTY\", {\r\n              uuid,\r\n              property: \"maxReflectionOrderReset\",\r\n              value: currentOrder + 1\r\n            });\r\n          }\r\n          e.preventDefault();\r\n          break;\r\n        case \"-\":\r\n        case \"_\":\r\n        case \"ArrowDown\":\r\n          // Decrease reflection order (min 0)\r\n          if (currentOrder > 0) {\r\n            emit(\"BEAMTRACE_SET_PROPERTY\", {\r\n              uuid,\r\n              property: \"maxReflectionOrderReset\",\r\n              value: currentOrder - 1\r\n            });\r\n          }\r\n          e.preventDefault();\r\n          break;\r\n        case \"b\":\r\n        case \"B\":\r\n          // Toggle between paths and sources view\r\n          if (mode === \"rays\") {\r\n            emit(\"BEAMTRACE_SET_PROPERTY\", {\r\n              uuid,\r\n              property: \"visualizationMode\",\r\n              value: \"beams\"\r\n            });\r\n          } else if (mode === \"beams\") {\r\n            emit(\"BEAMTRACE_SET_PROPERTY\", {\r\n              uuid,\r\n              property: \"visualizationMode\",\r\n              value: \"rays\"\r\n            });\r\n          } else {\r\n            // If \"both\", toggle to rays\r\n            emit(\"BEAMTRACE_SET_PROPERTY\", {\r\n              uuid,\r\n              property: \"visualizationMode\",\r\n              value: \"rays\"\r\n            });\r\n          }\r\n          e.preventDefault();\r\n          break;\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [uuid, solver?.maxReflectionOrder, mode]);\r\n\r\n  return null;\r\n};\r\n\r\nexport const BeamTraceTab = ({ uuid }: BeamTraceTabProps) => {\r\n  return (\r\n    <div>\r\n      <KeyboardShortcuts uuid={uuid} />\r\n      <Calculation uuid={uuid} />\r\n      <SourceReceiverPairs uuid={uuid} />\r\n      <Visualization uuid={uuid} />\r\n      <Statistics uuid={uuid} />\r\n      <ImpulseResponse uuid={uuid} />\r\n      <AmbisonicOutput uuid={uuid} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BeamTraceTab;\r\n"],"names":["PropertyNumberInput","createPropertyInputs","visualizationModeOptions","SourceReceiverPairs","uuid","open","toggle","useToggle","jsx","PropertyRowFolder","SourceReceiverMatrix","Calculation","Visualization","mode","setMode","useSolverProperty","showAllBeams","setShowAllBeams","jsxs","PropertyRow","PropertyRowLabel","PropertyRowSelect","PropertyRowCheckbox","value","BufferUsageBar","percent","overflow","color","Statistics","forceUpdate","useReducer","solver","useSolver","state","numPaths","metrics","bufferUsage","useEffect","unsub1","on","id","unsub2","Fragment","ImpulseResponse","disabled","PropertyButton","AmbisonicOutput","order","setOrder","useState","PropertyRowButton","emit","KeyboardShortcuts","handleKeyDown","e","currentOrder","BeamTraceTab"],"mappings":"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"}