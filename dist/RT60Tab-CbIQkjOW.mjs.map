{"version":3,"file":"RT60Tab-CbIQkjOW.mjs","sources":["../src/components/parameter-config/RT60Tab.tsx"],"sourcesContent":["import React, { useReducer } from 'react'\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { RT60 } from '../../compute/rt';\r\nimport { on } from \"../../messenger\";\r\nimport { useSolver } from \"../../store\";\r\nimport { pickProps } from \"../../common/helpers\";\r\nimport useToggle from \"../hooks/use-toggle\";\r\nimport { createPropertyInputs, PropertyButton } from \"./SolverComponents\";\r\nimport PropertyRowFolder from \"./property-row/PropertyRowFolder\";\r\nimport { useState } from 'react';\r\nimport { useEffect } from 'react';\r\n\r\nexport interface RT60TabProps {\r\n  uuid: string; \r\n}\r\n\r\nexport interface RT60TabState {\r\n  \r\n}\r\n\r\nfunction _useRT60Properties(properties: (keyof RT60)[], rt60solver: RT60, _set: any) {\r\n  const [state, setState] = useState(pickProps(properties, rt60solver));\r\n  const setFunction = <T extends keyof typeof state>(property: T, value: typeof state[T]) => {\r\n    setState({ ...state, [property]: value });\r\n    // set((solvers) => void (solvers.solvers[raytracer.uuid][property] = value));\r\n  };\r\n  return [state, setFunction] as [typeof state, typeof setFunction];\r\n}\r\n\r\nconst { PropertyNumberInput } = createPropertyInputs<RT60>(\r\n  \"RT60_SET_PROPERTY\"\r\n);\r\n\r\nconst Settings = ({ uuid }: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  return (\r\n    <PropertyRowFolder label=\"Room Settings\" open={open} onOpenClose={toggle}>\r\n    <PropertyNumberInput\r\n        uuid={uuid}\r\n        label=\"Room Volume\"\r\n        property=\"displayVolume\"\r\n        tooltip=\"Overrides the calculated room volume\"\r\n        elementProps={{\r\n          step: 0.01\r\n        }}\r\n      />\r\n    </PropertyRowFolder>\r\n  );\r\n};\r\n\r\n\r\nconst Export = ({uuid}: { uuid: string }) => {\r\n  const [open, toggle] = useToggle(true);\r\n  const {noResults} = useSolver(useShallow(state => pickProps([\"noResults\"], state.solvers[uuid] as RT60)));\r\n  const [, forceUpdate] = useReducer((c) => c + 1, 0) as [never, () => void]\r\n\r\n  useEffect(() => {\r\n    return on(\"UPDATE_RT60\", (_e) => {\r\n      forceUpdate();\r\n    });\r\n  }, [forceUpdate]);\r\n\r\n  return(\r\n    <PropertyRowFolder label=\"Export\" open={open} onOpenClose={toggle}>\r\n      <PropertyButton event=\"DOWNLOAD_RT60_RESULTS\" args={uuid} label=\"Download RT Results\" disabled={noResults} tooltip=\"Download RT Results as CSV File\"/>\r\n    </PropertyRowFolder>\r\n  )\r\n}\r\n\r\ntype DropdownOption = {\r\n  uuid: string, \r\n  name: string\r\n};\r\n\r\nfunction _getSourcesAndReceivers(state: any) {\r\n  const sources = [] as DropdownOption[];\r\n  const receivers = [] as DropdownOption[];\r\n  Object.keys(state.containers).forEach((uuid) => {\r\n    switch (state.containers[uuid].kind) {\r\n      case \"source\":\r\n        sources.push({uuid, name: state.containers[uuid].name});\r\n        break;\r\n      case \"receiver\":\r\n        receivers.push({uuid, name: state.containers[uuid].name});\r\n        break;\r\n      default:\r\n        console.log(state.containers)\r\n        break;\r\n    }\r\n  });\r\n  return [sources, receivers] as [DropdownOption[], DropdownOption[]];\r\n}\r\n\r\n\r\nexport const RT60Tab = ({ uuid }: RT60TabProps) => {\r\n  return (\r\n    <div>\r\n      <Settings uuid={uuid} />\r\n      <Export uuid={uuid} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RT60Tab; \r\n\r\n\r\n// export default class RT60Tab extends React.Component<RT60TabProps, RT60TabState> {\r\n//   constructor(props: RT60TabProps) {\r\n//     super(props);\r\n//     this.state = {\r\n      \r\n//     }\r\n//     this.handleObjectPropertyChange = this.handleObjectPropertyChange.bind(this);\r\n//     this.handleObjectPropertyValueChangeAsNumber = this.handleObjectPropertyValueChangeAsNumber.bind(this);\r\n//     this.handleObjectPropertyValueChangeAsString = this.handleObjectPropertyValueChangeAsString.bind(this);\r\n//     this.handleObjectPropertyButtonClick = this.handleObjectPropertyButtonClick.bind(this);\r\n//   } \r\n//   handleObjectPropertyChange(e: ObjectPropertyInputEvent) {\r\n// \t\tconst prop = e.name;\r\n// \t\tswitch (e.type) {\r\n// \t\t\tcase \"checkbox\":\r\n// \t\t\t\tthis.props.solver[prop] = e.value;\r\n// \t\t\t\tbreak;\r\n// \t\t\tcase \"text\":\r\n// \t\t\t\tthis.props.solver[prop] = e.value;\r\n// \t\t\t\tbreak;\r\n// \t\t\tcase \"number\":\r\n// \t\t\t\tthis.props.solver[prop] = Number(e.value);\r\n// \t\t\t\tbreak;\r\n//       default:\r\n// \t\t\t\t  this.props.solver[prop] = e.value;\r\n// \t\t\t\tbreak;\r\n//     }\r\n//     this.forceUpdate();\r\n//     this.props.messenger.postMessage(\"RESULTS_SHOULD_UPDATE\");\r\n//     this.props.messenger.postMessage(\"GUTTER_SHOULD_UPDATE\");\r\n// \t}\r\n//   handleObjectPropertyValueChangeAsNumber(\r\n// \t\tid: string,\r\n// \t\tprop: string,\r\n// \t\tvalueAsNumber: number\r\n// \t) {\r\n//     this.props.solver[prop] = valueAsNumber;\r\n//     this.forceUpdate();\r\n// \t}\r\n// \thandleObjectPropertyValueChangeAsString(\r\n// \t\tid: string,\r\n// \t\tprop: string,\r\n// \t\tvalueAsString: string\r\n// \t) {\r\n//     this.props.solver[prop] = valueAsString;\r\n//     this.forceUpdate();\r\n//   }\r\n//   handleObjectPropertyButtonClick(e: React.MouseEvent<HTMLInputElement, MouseEvent>) {\r\n//     // switch (e.currentTarget.name) {\r\n//     //   default: break;\r\n//     // }\r\n//     this.forceUpdate();\r\n//   }\r\n//   render() {\r\n//     return (\r\n//       <RT60Properties\r\n//         messenger={this.props.messenger}\r\n//         object={this.props.solver}\r\n//         onPropertyChange={this.handleObjectPropertyChange}\r\n//         onPropertyValueChangeAsNumber={this.handleObjectPropertyValueChangeAsNumber}\r\n//         onPropertyValueChangeAsString={this.handleObjectPropertyValueChangeAsString}\r\n//         onButtonClick={this.handleObjectPropertyButtonClick}\r\n//       />\r\n//     );\r\n//   }\r\n// }\r\n\r\n// function getSourcesAndReceivers(getSourcesAndReceivers: any): [any, any] {\r\n//   throw new Error('Function not implemented.');\r\n// }\r\n// function useImageSourceProperties(arg0: string[], imagesourcesolver: any, set: any): [any, any] {\r\n//   throw new Error('Function not implemented.');\r\n// }\r\n\r\n"],"names":["PropertyNumberInput","createPropertyInputs","Settings","uuid","open","toggle","useToggle","PropertyRowFolder","jsx","Export","noResults","useSolver","useShallow","state","pickProps","forceUpdate","useReducer","c","useEffect","on","_e","PropertyButton","RT60Tab"],"mappings":";;;;AA6BA,MAAM,EAAE,qBAAAA,MAAwBC;AAAA,EAC9B;AACF,GAEMC,IAAW,CAAC,EAAE,MAAAC,QAA6B;AAC/C,QAAM,CAACC,GAAMC,CAAM,IAAIC,EAAU,EAAI;AACrC,2BACGC,GAAA,EAAkB,OAAM,iBAAgB,MAAAH,GAAY,aAAaC,GAClE,UAAA,gBAAAG;AAAA,IAACR;AAAA,IAAA;AAAA,MACG,MAAAG;AAAA,MACA,OAAM;AAAA,MACN,UAAS;AAAA,MACT,SAAQ;AAAA,MACR,cAAc;AAAA,QACZ,MAAM;AAAA,MAAA;AAAA,IACR;AAAA,EAAA,GAEJ;AAEJ,GAGMM,IAAS,CAAC,EAAC,MAAAN,QAA4B;AAC3C,QAAM,CAACC,GAAMC,CAAM,IAAIC,EAAU,EAAI,GAC/B,EAAC,WAAAI,EAAA,IAAaC,EAAUC,EAAW,CAAAC,MAASC,EAAU,CAAC,WAAW,GAAGD,EAAM,QAAQV,CAAI,CAAS,CAAC,CAAC,GAClG,CAAA,EAAGY,CAAW,IAAIC,EAAW,CAACC,MAAMA,IAAI,GAAG,CAAC;AAElD,SAAAC,EAAU,MACDC,EAAG,eAAe,CAACC,MAAO;AAC/B,IAAAL,EAAA;AAAA,EACF,CAAC,GACA,CAACA,CAAW,CAAC,qBAGbR,GAAA,EAAkB,OAAM,UAAS,MAAAH,GAAY,aAAaC,GACzD,UAAA,gBAAAG,EAACa,GAAA,EAAe,OAAM,yBAAwB,MAAMlB,GAAM,OAAM,uBAAsB,UAAUO,GAAW,SAAQ,mCAAiC,EAAA,CACtJ;AAEJ,GA2BaY,IAAU,CAAC,EAAE,MAAAnB,0BAErB,OAAA,EACC,UAAA;AAAA,EAAA,gBAAAK,EAACN,KAAS,MAAAC,GAAY;AAAA,EACtB,gBAAAK,EAACC,KAAO,MAAAN,EAAA,CAAY;AAAA,GACtB;"}