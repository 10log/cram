{"version":3,"file":"SourceReceiverMatrix-DmxBth7B.mjs","sources":["../src/components/parameter-config/SourceReceiverMatrix.tsx"],"sourcesContent":["import React, { memo, useMemo, useCallback } from \"react\";\r\nimport Box from \"@mui/material/Box\";\r\nimport Typography from \"@mui/material/Typography\";\r\nimport Checkbox from \"@mui/material/Checkbox\";\r\nimport type { SxProps, Theme } from \"@mui/material/styles\";\r\nimport { useContainer } from \"../../store\";\r\nimport { useSolverProperty } from \"./SolverComponents\";\r\nimport RayTracer from \"../../compute/raytracer\";\r\n\r\nconst matrixContainerSx = (disabled: boolean): SxProps<Theme> => ({\r\n  p: \"4px 8px\",\r\n  overflowX: \"auto\",\r\n  opacity: disabled ? 0.5 : 1,\r\n  pointerEvents: disabled ? \"none\" : \"auto\",\r\n});\r\n\r\nconst tableSx: SxProps<Theme> = {\r\n  width: \"100%\",\r\n  borderCollapse: \"collapse\",\r\n  fontSize: 11,\r\n  \"& th, & td\": {\r\n    p: \"4px 6px\",\r\n  },\r\n};\r\n\r\nconst headerCellSx: SxProps<Theme> = {\r\n  textAlign: \"center\",\r\n  fontWeight: 500,\r\n  color: \"#1c2127\",\r\n  borderBottom: \"1px solid #e1e4e8\",\r\n  whiteSpace: \"nowrap\",\r\n  maxWidth: 80,\r\n  overflow: \"hidden\",\r\n  textOverflow: \"ellipsis\",\r\n};\r\n\r\nconst rowHeaderCellSx: SxProps<Theme> = {\r\n  fontWeight: 500,\r\n  color: \"#1c2127\",\r\n  borderRight: \"1px solid #e1e4e8\",\r\n  whiteSpace: \"nowrap\",\r\n  maxWidth: 80,\r\n  overflow: \"hidden\",\r\n  textOverflow: \"ellipsis\",\r\n};\r\n\r\nconst dataCellSx: SxProps<Theme> = {\r\n  textAlign: \"center\",\r\n  borderBottom: \"1px solid #f0f0f0\",\r\n};\r\n\r\nconst cornerCellSx: SxProps<Theme> = {\r\n  textAlign: \"right\",\r\n  fontWeight: 400,\r\n  fontSize: 10,\r\n  color: \"#656d76\",\r\n  borderBottom: \"1px solid #e1e4e8\",\r\n  borderRight: \"1px solid #e1e4e8\",\r\n};\r\n\r\nconst emptyMessageSx: SxProps<Theme> = {\r\n  p: \"12px 8px\",\r\n  fontSize: 11,\r\n  color: \"#8c959f\",\r\n  fontStyle: \"italic\",\r\n  textAlign: \"center\",\r\n};\r\n\r\nconst checkboxSx: SxProps<Theme> = {\r\n  p: 0,\r\n  width: 14,\r\n  height: 14,\r\n  \"& .MuiSvgIcon-root\": {\r\n    fontSize: 18,\r\n  },\r\n};\r\n\r\ninterface SourceReceiverMatrixProps {\r\n  uuid: string;\r\n  disabled?: boolean;\r\n  eventType?: \"RAYTRACER_SET_PROPERTY\" | \"IMAGESOURCE_SET_PROPERTY\" | \"BEAMTRACE_SET_PROPERTY\";\r\n}\r\n\r\nexport const SourceReceiverMatrix = memo(({ uuid, disabled = false, eventType = \"RAYTRACER_SET_PROPERTY\" }: SourceReceiverMatrixProps) => {\r\n  const containers = useContainer((state) => state.containers);\r\n  const version = useContainer((state) => state.version);\r\n\r\n  const sources = useMemo(() => {\r\n    return Object.values(containers)\r\n      .filter(c => c.kind === \"source\")\r\n      .map(c => ({ uuid: c.uuid, name: c.name }));\r\n  }, [containers, version]);\r\n\r\n  const receivers = useMemo(() => {\r\n    return Object.values(containers)\r\n      .filter(c => c.kind === \"receiver\")\r\n      .map(c => ({ uuid: c.uuid, name: c.name }));\r\n  }, [containers, version]);\r\n\r\n  const [sourceIDsRaw, setSourceIDs] = useSolverProperty<RayTracer, \"sourceIDs\">(\r\n    uuid,\r\n    \"sourceIDs\",\r\n    eventType\r\n  );\r\n\r\n  const [receiverIDsRaw, setReceiverIDs] = useSolverProperty<RayTracer, \"receiverIDs\">(\r\n    uuid,\r\n    \"receiverIDs\",\r\n    eventType\r\n  );\r\n\r\n  // Provide defaults for undefined arrays\r\n  const sourceIDs = sourceIDsRaw || [];\r\n  const receiverIDs = receiverIDsRaw || [];\r\n\r\n  // Check if a source-receiver pair is selected\r\n  const isPairSelected = useCallback((sourceId: string, receiverId: string) => {\r\n    return sourceIDs.includes(sourceId) && receiverIDs.includes(receiverId);\r\n  }, [sourceIDs, receiverIDs]);\r\n\r\n  // Toggle a source-receiver pair\r\n  // Note: With the current data model, selecting a pair means adding the source to sourceIDs\r\n  // and the receiver to receiverIDs. All combinations of sourceIDs × receiverIDs form pairs.\r\n  // Unchecking removes the source/receiver only if no other pairs would be affected.\r\n  const togglePair = useCallback((sourceId: string, receiverId: string, checked: boolean) => {\r\n    if (checked) {\r\n      // Add both source and receiver if not already present\r\n      const newSourceIDs = sourceIDs.includes(sourceId) ? sourceIDs : [...sourceIDs, sourceId];\r\n      const newReceiverIDs = receiverIDs.includes(receiverId) ? receiverIDs : [...receiverIDs, receiverId];\r\n\r\n      if (newSourceIDs !== sourceIDs) {\r\n        setSourceIDs({ value: newSourceIDs });\r\n      }\r\n      if (newReceiverIDs !== receiverIDs) {\r\n        setReceiverIDs({ value: newReceiverIDs });\r\n      }\r\n    } else {\r\n      // Remove the source if it only pairs with this one receiver\r\n      if (receiverIDs.length === 1) {\r\n        setSourceIDs({ value: sourceIDs.filter(id => id !== sourceId) });\r\n      }\r\n\r\n      // Remove the receiver if it only pairs with this one source\r\n      if (sourceIDs.length === 1) {\r\n        setReceiverIDs({ value: receiverIDs.filter(id => id !== receiverId) });\r\n      }\r\n    }\r\n  }, [sourceIDs, receiverIDs, setSourceIDs, setReceiverIDs]);\r\n\r\n  if (sources.length === 0 && receivers.length === 0) {\r\n    return <Typography sx={emptyMessageSx}>Add sources and receivers to configure pairs</Typography>;\r\n  }\r\n\r\n  if (sources.length === 0) {\r\n    return <Typography sx={emptyMessageSx}>Add sources to configure pairs</Typography>;\r\n  }\r\n\r\n  if (receivers.length === 0) {\r\n    return <Typography sx={emptyMessageSx}>Add receivers to configure pairs</Typography>;\r\n  }\r\n\r\n  return (\r\n    <Box sx={matrixContainerSx(disabled)}>\r\n      <Box component=\"table\" sx={tableSx}>\r\n        <thead>\r\n          <tr>\r\n            <Box component=\"th\" sx={cornerCellSx}>Src \\ Rec</Box>\r\n            {receivers.map(rec => (\r\n              <Box component=\"th\" key={rec.uuid} sx={headerCellSx} title={rec.name}>\r\n                {rec.name}\r\n              </Box>\r\n            ))}\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {sources.map(src => (\r\n            <tr key={src.uuid}>\r\n              <Box component=\"td\" sx={rowHeaderCellSx} title={src.name}>{src.name}</Box>\r\n              {receivers.map(rec => (\r\n                <Box component=\"td\" key={`${src.uuid}-${rec.uuid}`} sx={dataCellSx}>\r\n                  <Checkbox\r\n                    checked={isPairSelected(src.uuid, rec.uuid)}\r\n                    onChange={(e) => togglePair(src.uuid, rec.uuid, e.target.checked)}\r\n                    title={`${src.name} → ${rec.name}`}\r\n                    sx={checkboxSx}\r\n                    size=\"small\"\r\n                  />\r\n                </Box>\r\n              ))}\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </Box>\r\n    </Box>\r\n  );\r\n});\r\n\r\nexport default SourceReceiverMatrix;\r\n"],"names":["matrixContainerSx","disabled","tableSx","headerCellSx","rowHeaderCellSx","dataCellSx","cornerCellSx","emptyMessageSx","checkboxSx","SourceReceiverMatrix","memo","uuid","eventType","containers","useContainer","state","version","sources","useMemo","c","receivers","sourceIDsRaw","setSourceIDs","useSolverProperty","receiverIDsRaw","setReceiverIDs","sourceIDs","receiverIDs","isPairSelected","useCallback","sourceId","receiverId","togglePair","checked","newSourceIDs","newReceiverIDs","id","jsx","Typography","Box","jsxs","rec","src","Checkbox","e"],"mappings":";;;;AASA,MAAMA,IAAoB,CAACC,OAAuC;AAAA,EAChE,GAAG;AAAA,EACH,WAAW;AAAA,EACX,SAASA,IAAW,MAAM;AAAA,EAC1B,eAAeA,IAAW,SAAS;AACrC,IAEMC,IAA0B;AAAA,EAC9B,OAAO;AAAA,EACP,gBAAgB;AAAA,EAChB,UAAU;AAAA,EACV,cAAc;AAAA,IACZ,GAAG;AAAA,EAAA;AAEP,GAEMC,IAA+B;AAAA,EACnC,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,OAAO;AAAA,EACP,cAAc;AAAA,EACd,YAAY;AAAA,EACZ,UAAU;AAAA,EACV,UAAU;AAAA,EACV,cAAc;AAChB,GAEMC,IAAkC;AAAA,EACtC,YAAY;AAAA,EACZ,OAAO;AAAA,EACP,aAAa;AAAA,EACb,YAAY;AAAA,EACZ,UAAU;AAAA,EACV,UAAU;AAAA,EACV,cAAc;AAChB,GAEMC,IAA6B;AAAA,EACjC,WAAW;AAAA,EACX,cAAc;AAChB,GAEMC,IAA+B;AAAA,EACnC,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,UAAU;AAAA,EACV,OAAO;AAAA,EACP,cAAc;AAAA,EACd,aAAa;AACf,GAEMC,IAAiC;AAAA,EACrC,GAAG;AAAA,EACH,UAAU;AAAA,EACV,OAAO;AAAA,EACP,WAAW;AAAA,EACX,WAAW;AACb,GAEMC,IAA6B;AAAA,EACjC,GAAG;AAAA,EACH,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,sBAAsB;AAAA,IACpB,UAAU;AAAA,EAAA;AAEd,GAQaC,IAAuBC,EAAK,CAAC,EAAE,MAAAC,GAAM,UAAAV,IAAW,IAAO,WAAAW,IAAY,+BAA0D;AACxI,QAAMC,IAAaC,EAAa,CAACC,MAAUA,EAAM,UAAU,GACrDC,IAAUF,EAAa,CAACC,MAAUA,EAAM,OAAO,GAE/CE,IAAUC,EAAQ,MACf,OAAO,OAAOL,CAAU,EAC5B,OAAO,CAAAM,MAAKA,EAAE,SAAS,QAAQ,EAC/B,IAAI,CAAAA,OAAM,EAAE,MAAMA,EAAE,MAAM,MAAMA,EAAE,OAAO,GAC3C,CAACN,GAAYG,CAAO,CAAC,GAElBI,IAAYF,EAAQ,MACjB,OAAO,OAAOL,CAAU,EAC5B,OAAO,CAAAM,MAAKA,EAAE,SAAS,UAAU,EACjC,IAAI,CAAAA,OAAM,EAAE,MAAMA,EAAE,MAAM,MAAMA,EAAE,OAAO,GAC3C,CAACN,GAAYG,CAAO,CAAC,GAElB,CAACK,GAAcC,CAAY,IAAIC;AAAA,IACnCZ;AAAA,IACA;AAAA,IACAC;AAAA,EAAA,GAGI,CAACY,GAAgBC,CAAc,IAAIF;AAAA,IACvCZ;AAAA,IACA;AAAA,IACAC;AAAA,EAAA,GAIIc,IAAYL,KAAgB,CAAA,GAC5BM,IAAcH,KAAkB,CAAA,GAGhCI,IAAiBC,EAAY,CAACC,GAAkBC,MAC7CL,EAAU,SAASI,CAAQ,KAAKH,EAAY,SAASI,CAAU,GACrE,CAACL,GAAWC,CAAW,CAAC,GAMrBK,IAAaH,EAAY,CAACC,GAAkBC,GAAoBE,MAAqB;AACzF,QAAIA,GAAS;AAEX,YAAMC,IAAeR,EAAU,SAASI,CAAQ,IAAIJ,IAAY,CAAC,GAAGA,GAAWI,CAAQ,GACjFK,IAAiBR,EAAY,SAASI,CAAU,IAAIJ,IAAc,CAAC,GAAGA,GAAaI,CAAU;AAEnG,MAAIG,MAAiBR,KACnBJ,EAAa,EAAE,OAAOY,GAAc,GAElCC,MAAmBR,KACrBF,EAAe,EAAE,OAAOU,GAAgB;AAAA,IAE5C;AAEE,MAAIR,EAAY,WAAW,KACzBL,EAAa,EAAE,OAAOI,EAAU,OAAO,OAAMU,MAAON,CAAQ,GAAG,GAI7DJ,EAAU,WAAW,KACvBD,EAAe,EAAE,OAAOE,EAAY,OAAO,OAAMS,MAAOL,CAAU,GAAG;AAAA,EAG3E,GAAG,CAACL,GAAWC,GAAaL,GAAcG,CAAc,CAAC;AAEzD,SAAIR,EAAQ,WAAW,KAAKG,EAAU,WAAW,IACxC,gBAAAiB,EAACC,GAAA,EAAW,IAAI/B,GAAgB,UAAA,gDAA4C,IAGjFU,EAAQ,WAAW,IACd,gBAAAoB,EAACC,GAAA,EAAW,IAAI/B,GAAgB,UAAA,kCAA8B,IAGnEa,EAAU,WAAW,IAChB,gBAAAiB,EAACC,GAAA,EAAW,IAAI/B,GAAgB,UAAA,oCAAgC,IAIvE,gBAAA8B,EAACE,GAAA,EAAI,IAAIvC,EAAkBC,CAAQ,GACjC,UAAA,gBAAAuC,EAACD,GAAA,EAAI,WAAU,SAAQ,IAAIrC,GACzB,UAAA;AAAA,IAAA,gBAAAmC,EAAC,SAAA,EACC,4BAAC,MAAA,EACC,UAAA;AAAA,MAAA,gBAAAA,EAACE,GAAA,EAAI,WAAU,MAAK,IAAIjC,GAAc,UAAA,cAAS;AAAA,MAC9Cc,EAAU,IAAI,CAAAqB,MACb,gBAAAJ,EAACE,GAAA,EAAI,WAAU,MAAoB,IAAIpC,GAAc,OAAOsC,EAAI,MAC7D,UAAAA,EAAI,KAAA,GADkBA,EAAI,IAE7B,CACD;AAAA,IAAA,EAAA,CACH,EAAA,CACF;AAAA,sBACC,SAAA,EACE,UAAAxB,EAAQ,IAAI,CAAAyB,wBACV,MAAA,EACC,UAAA;AAAA,MAAA,gBAAAL,EAACE,GAAA,EAAI,WAAU,MAAK,IAAInC,GAAiB,OAAOsC,EAAI,MAAO,UAAAA,EAAI,KAAA,CAAK;AAAA,MACnEtB,EAAU,IAAI,CAAAqB,MACb,gBAAAJ,EAACE,KAAI,WAAU,MAAqC,IAAIlC,GACtD,UAAA,gBAAAgC;AAAA,QAACM;AAAA,QAAA;AAAA,UACC,SAASf,EAAec,EAAI,MAAMD,EAAI,IAAI;AAAA,UAC1C,UAAU,CAACG,MAAMZ,EAAWU,EAAI,MAAMD,EAAI,MAAMG,EAAE,OAAO,OAAO;AAAA,UAChE,OAAO,GAAGF,EAAI,IAAI,MAAMD,EAAI,IAAI;AAAA,UAChC,IAAIjC;AAAA,UACJ,MAAK;AAAA,QAAA;AAAA,MAAA,EACP,GAPuB,GAAGkC,EAAI,IAAI,IAAID,EAAI,IAAI,EAQhD,CACD;AAAA,IAAA,KAZMC,EAAI,IAab,CACD,EAAA,CACH;AAAA,EAAA,EAAA,CACF,EAAA,CACF;AAEJ,CAAC;"}